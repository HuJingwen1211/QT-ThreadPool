# Qt线程池项目文档

## 项目概述

这是一个基于Qt框架实现的线程池系统，具有可视化界面，支持动态线程管理、任务调度和实时状态监控。项目采用Qt的信号槽机制实现线程池与UI的完美联动。

## 功能特性

### 核心功能
- **动态线程管理**：支持最小/最大线程数配置，自动扩容和缩容
- **任务队列管理**：支持任务添加、执行、清空等操作
- **实时状态监控**：可视化显示线程状态、任务队列、运行日志
- **线程安全**：使用Qt的互斥锁和条件变量保证线程安全

### 可视化界面
- **线程状态区**：实时显示工作线程和空闲线程
- **任务队列区**：显示等待执行、正在执行、已完成的任务
- **统计信息区**：显示线程和任务的实时统计
- **运行日志区**：显示详细的运行日志

## 项目结构

```
ThreadPool/
├── main.cpp                 # 程序入口
├── mainwindow.cpp          # 主窗口实现
├── mainwindow.h            # 主窗口头文件
├── mainwindow.ui           # 主窗口UI设计文件
├── threadpool.cpp          # 线程池核心实现
├── threadpool.h            # 线程池头文件
├── taskqueue.cpp           # 任务队列实现
├── taskqueue.h             # 任务队列头文件
└── ThreadPool.pro          # Qt项目文件
```

## 核心类设计

### ThreadPool（线程池）
- **功能**：管理线程池的生命周期和任务调度
- **核心组件**：
  - `WorkerThread`：工作线程类，执行具体任务
  - `ManagerThread`：管理者线程，负责动态调整线程数量
- **信号**：
  - `threadStateChanged(int threadId, int state)`：线程状态变化
  - `taskCompleted(int taskId)`：任务完成
  - `logMessage(const QString& message)`：日志输出

### TaskQueue（任务队列）
- **功能**：管理任务的存储和调度
- **特性**：线程安全，支持信号槽机制
- **信号**：
  - `taskAdded()`：任务添加
  - `taskRemoved()`：任务移除
  - `queueCleared()`：队列清空

### MainWindow（主窗口）
- **功能**：提供用户界面和交互逻辑
- **特性**：实时更新线程状态、任务队列、统计信息

## 线程状态管理

### 状态定义
- **0**：空闲状态（线程等待任务）
- **1**：忙碌状态（线程正在执行任务）
- **-1**：退出状态（线程已退出）

### 状态流转
```
创建线程 → 空闲(0) → 忙碌(1) → 空闲(0) → 退出(-1)
```

## 动态线程管理

### 扩容策略
- **触发条件**：任务数 > 存活线程数 且 存活线程数 < 最大线程数
- **扩容速度**：每次最多创建2个线程
- **检查频率**：每5秒检查一次

### 缩容策略
- **触发条件**：忙线程数 × 2 < 存活线程数 且 存活线程数 > 最小线程数
- **缩容速度**：每次最多销毁2个线程

## 使用方法

### 1. 启动线程池
1. 设置最小线程数和最大线程数
2. 点击"开始"按钮启动线程池

### 2. 添加任务
1. 点击"添加任务"按钮
2. 系统自动生成模拟任务并添加到队列
3. 任务会被空闲线程自动执行

### 3. 监控状态
- **线程状态区**：查看当前工作线程和空闲线程
- **任务队列区**：查看任务执行状态
- **统计信息区**：查看实时统计数据
- **运行日志区**：查看详细运行日志

### 4. 清空队列
- 点击"清空队列"按钮清空等待执行的任务

### 5. 停止线程池
- 点击"停止"按钮安全关闭线程池

## 技术特点

### 线程安全
- 使用 `QMutex` 保护共享资源
- 使用 `QWaitCondition` 实现线程同步
- 采用RAII模式自动管理锁资源

### 信号槽机制
- 线程池与UI通过信号槽解耦
- 支持跨线程信号传递
- 自动处理线程间通信

### 性能优化
- 延迟信号发射避免连接时机问题
- 智能线程管理减少资源浪费
- 高效的任务调度算法

### 用户体验
- 实时状态更新
- 直观的可视化界面
- 详细的运行日志

## 编译运行

### 环境要求
- Qt 6.x
- C++17 或更高版本
- 支持C++的编译器（MSVC、GCC、Clang）

### 编译步骤
1. 使用Qt Creator打开 `ThreadPool.pro`
2. 配置编译环境
3. 点击运行按钮

### 运行效果
- 线程池启动后显示创建日志
- 添加任务后实时更新队列状态
- 线程状态动态变化
- 管理者线程自动调整线程数量

## 扩展建议

### 功能扩展
- 支持自定义任务函数
- 添加任务优先级
- 支持任务取消和暂停
- 添加性能监控图表

### 技术优化
- 实现线程池配置持久化
- 添加异常处理机制
- 优化内存管理策略
- 支持多线程池管理

## 总结

本项目展示了Qt框架在并发编程中的强大能力，通过信号槽机制实现了线程池与UI的完美结合。代码结构清晰，功能完整，具有良好的可扩展性和维护性。